# üì¶ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–π –º–æ–¥—É–ª—å (plug-and-play)

## 1. –°–æ–∑–¥–∞–π—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –º–æ–¥—É–ª—è

–í –ø–∞–ø–∫–µ `routers/` —Å–æ–∑–¥–∞–π—Ç–µ –ø–æ–¥–ø–∞–ø–∫—É —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –∏–º–µ–Ω–µ–º –≤–∞—à–µ–≥–æ –º–æ–¥—É–ª—è, –Ω–∞–ø—Ä–∏–º–µ—Ä, `my_module`:

```
routers/
  my_module/
    __init__.py
    router.py
    messages.py
    (config.py)         # –µ—Å–ª–∏ –Ω—É–∂–Ω—ã —Å–≤–æ–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    (keyboards.py)      # –µ—Å–ª–∏ –Ω—É–∂–Ω—ã —Å–≤–æ–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
    (services/)         # –µ—Å–ª–∏ –µ—Å—Ç—å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
    (auth/)            # –µ—Å–ª–∏ –º–æ–¥—É–ª—é –Ω—É–∂–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
```

---

## 2. –†–µ–∞–ª–∏–∑—É–π—Ç–µ —Ä–æ—É—Ç–µ—Ä

–í `router.py`:
- –°–æ–∑–¥–∞–π—Ç–µ –æ–±—ä–µ–∫—Ç `Router` –∏–∑ aiogram.
- –û–ø–∏—à–∏—Ç–µ —Ö–µ–Ω–¥–ª–µ—Ä—ã (–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥, —Å–æ–æ–±—â–µ–Ω–∏–π, callback –∏ —Ç.–¥.).
- –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ —Å–≤–æ–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ `messages.py`.
- –ï—Å–ª–∏ –Ω—É–∂–Ω—ã –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (`start`, `no_access`), –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –∏—Ö –∏–∑ –∫–æ—Ä–Ω–µ–≤–æ–≥–æ `messages.py`:
  ```python
  from .messages import MESSAGES  # –ª–æ–∫–∞–ª—å–Ω—ã–µ
  from messages import MESSAGES as GLOBAL_MESSAGES  # –≥–ª–æ–±–∞–ª—å–Ω—ã–µ
  ```

**‚ö†Ô∏è –í–∞–∂–Ω–æ –¥–ª—è callback_query –≤ aiogram 3.x:**
```python
from aiogram import F

# –ü—Ä–∞–≤–∏–ª—å–Ω–æ:
@my_module_router.callback_query(F.data == "my_callback")

# –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:
@my_module_router.callback_query(text="my_callback")  # –°—Ç–∞—Ä—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å 2.x
```

---

## 3. –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ —Ä–æ—É—Ç–µ—Ä –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –º–µ–Ω—é

–í `__init__.py` –º–æ–¥—É–ª—è:
```python
from .router import my_module_router

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!)
MENU_CONFIG = {
    'text': 'üîß –ú–æ–π –º–æ–¥—É–ª—å',
    'callback_data': 'my_mode',
    'order': 30  # –ø–æ—Ä—è–¥–æ–∫ –≤ –º–µ–Ω—é (10-email, 15-test, 20-id)
}
```

**üî¢ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è order:**
- `1` - core (–≥–ª–æ–±–∞–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã - –ó–ê–†–ï–ó–ï–†–í–ò–†–û–í–ê–ù–û)
- `10` - email_router (–æ—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å)
- `15-20` - –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏  
- `25-30` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –º–æ–¥—É–ª–∏
- `30+` - —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏ (id, debug –∏ —Ç.–¥.)

**‚ö†Ô∏è –í–ê–ñ–ù–û**: –ó–Ω–∞—á–µ–Ω–∏–µ `1` –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è `core` –º–æ–¥—É–ª—è (–≥–ª–æ–±–∞–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã `/start`, `/menu`)

---

## 4. –°–æ–∑–¥–∞–π—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è –º–æ–¥—É–ª—è

–í `messages.py`:
```python
MESSAGES = {
    "activation": "üîß –ú–æ–π –º–æ–¥—É–ª—å –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!",
    "help": "–≠—Ç–æ —Å–ø—Ä–∞–≤–∫–∞ –ø–æ –º–æ–µ–º—É –º–æ–¥—É–ª—é",
    "error": "–û—à–∏–±–∫–∞ –≤ –º–æ–µ–º –º–æ–¥—É–ª–µ"
}
```

---

## 5. –ü—Ä–∏–º–µ—Ä –ø—Ä–æ—Å—Ç–æ–≥–æ –º–æ–¥—É–ª—è

### `router.py`:
```python
from aiogram import Router, F
from aiogram.types import CallbackQuery, Message
from .messages import MESSAGES

my_module_router = Router()

@my_module_router.callback_query(F.data == "my_mode")
async def activate_my_module(callback: CallbackQuery):
    await callback.message.edit_text(MESSAGES["activation"])
    await callback.answer("–ú–æ–¥—É–ª—å –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!")

@my_module_router.message(F.text.contains("–ø—Ä–∏–≤–µ—Ç"))
async def hello_handler(message: Message):
    await message.reply("–ü—Ä–∏–≤–µ—Ç –∏–∑ –º–æ–µ–≥–æ –º–æ–¥—É–ª—è!")
```

### `messages.py`:
```python
MESSAGES = {
    "activation": "üîß –ú–æ–π –º–æ–¥—É–ª—å –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!\n\n–ù–∞–ø–∏—à–∏—Ç–µ '–ø—Ä–∏–≤–µ—Ç' –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.",
}
```

### `__init__.py`:
```python
from .router import my_module_router

MENU_CONFIG = {
    'text': 'üîß –ú–æ–π –º–æ–¥—É–ª—å',
    'callback_data': 'my_mode',
    'order': 30
}
```

---

## 6. üö® –í–∞–∂–Ω—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

### ‚ùå –ß—Ç–æ –ù–ï–õ–¨–ó–Ø –¥–µ–ª–∞—Ç—å –≤ –º–æ–¥—É–ª—è—Ö:

#### **1. –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –≤ –º–æ–¥—É–ª—è—Ö**
```python
# ‚ùå –ó–ê–ü–†–ï–©–ï–ù–û - –Ω–µ –¥–æ–±–∞–≤–ª—è–π—Ç–µ –≤ —Å–≤–æ–∏ –º–æ–¥—É–ª–∏:
@router.message(Command("start"))     # –¢–æ–ª—å–∫–æ –≤ core –º–æ–¥—É–ª–µ!
@router.message(Command("menu"))      # –¢–æ–ª—å–∫–æ –≤ core –º–æ–¥—É–ª–µ!
@router.message(Command("help"))      # –¢–æ–ª—å–∫–æ –≤ core –º–æ–¥—É–ª–µ!
```

**–ü–æ—á–µ–º—É –∑–∞–ø—Ä–µ—â–µ–Ω–æ**: –ï—Å–ª–∏ –≤–∞—à –º–æ–¥—É–ª—å –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω, —ç—Ç–∏ –∫–æ–º–∞–Ω–¥—ã –ø–µ—Ä–µ—Å—Ç–∞–Ω—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –¥–ª—è –≤—Å–µ–≥–æ –±–æ—Ç–∞.

#### **2. –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤**
```python
# ‚ùå –û–ü–ê–°–ù–û - –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –í–°–ï —Å–æ–æ–±—â–µ–Ω–∏—è:
@router.message()
async def handle_all_messages(message: Message):

# ‚ùå –û–ü–ê–°–ù–û - –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –í–°–ï callback:
@router.callback_query()
async def handle_all_callbacks(callback: CallbackQuery):
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è**: –í–∞—à –º–æ–¥—É–ª—å –º–æ–∂–µ—Ç "—É–∫—Ä–∞—Å—Ç—å" —Å–æ–æ–±—â–µ–Ω–∏—è, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ –¥—Ä—É–≥–∏–º –º–æ–¥—É–ª—è–º.

#### **3. –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è –º–æ–¥—É–ª—è**
```python
# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - —Å–æ–∑–¥–∞–≤–∞—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã:
keyboards/my_module_ui.py      # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: routers/my_module/keyboards.py
services/my_module_service.py  # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: routers/my_module/services.py
```

### ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è:

#### **1. –ú–æ–¥—É–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–º**
```
routers/my_module/
‚îú‚îÄ‚îÄ __init__.py         # –≠–∫—Å–ø–æ—Ä—Ç + MENU_CONFIG
‚îú‚îÄ‚îÄ router.py           # –õ–æ–≥–∏–∫–∞ –º–æ–¥—É–ª—è
‚îú‚îÄ‚îÄ messages.py         # –¢–µ–∫—Å—Ç—ã –º–æ–¥—É–ª—è
‚îú‚îÄ‚îÄ keyboards.py        # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã –º–æ–¥—É–ª—è (–µ—Å–ª–∏ –Ω—É–∂–Ω—ã)
‚îú‚îÄ‚îÄ services.py         # –°–µ—Ä–≤–∏—Å—ã –º–æ–¥—É–ª—è (–µ—Å–ª–∏ –Ω—É–∂–Ω—ã)
‚îú‚îÄ‚îÄ config.py           # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–¥—É–ª—è (–µ—Å–ª–∏ –Ω—É–∂–Ω—ã)
‚îú‚îÄ‚îÄ .env                # –°–µ–∫—Ä–µ—Ç—ã –º–æ–¥—É–ª—è (–µ—Å–ª–∏ –Ω—É–∂–Ω—ã)
‚îî‚îÄ‚îÄ auth/               # OAuth –º–æ–¥—É–ª—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–∞)
```

#### **2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã**
```python
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û:
@router.callback_query(F.data == "my_specific_callback")
@router.message(F.text.contains("keyword"))
@router.message(Command("my_command"))  # –¢–æ–ª—å–∫–æ –∫–æ–º–∞–Ω–¥—ã –≤–∞—à–µ–≥–æ –º–æ–¥—É–ª—è!
```

#### **3. –ü—Ä–∏–Ω—Ü–∏–ø plug-and-play**
- –ú–æ–¥—É–ª—å –º–æ–∂–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ –¥—Ä—É–≥–æ–π –ø—Ä–æ–µ–∫—Ç –∏ –æ–Ω –∑–∞—Ä–∞–±–æ—Ç–∞–µ—Ç
- –ú–æ–¥—É–ª—å –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥—Ä—É–≥–∏—Ö –º–æ–¥—É–ª–µ–π  
- –ú–æ–¥—É–ª—å –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –±–µ–∑ –ø–æ–ª–æ–º–∫–∏ –æ—Å—Ç–∞–ª—å–Ω–æ–≥–æ –±–æ—Ç–∞
- –í—Å–µ —Ä–µ—Å—É—Ä—Å—ã (–∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã, —Å–µ—Ä–≤–∏—Å—ã) –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –º–æ–¥—É–ª—è

---

## 7. üîê –ú–æ–¥—É–ª—å–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (–¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö API)

–ï—Å–ª–∏ –≤–∞—à –º–æ–¥—É–ª—å —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏ (Google API, Discord API –∏ —Ç.–¥.), —Å–æ–∑–¥–∞–π—Ç–µ –ø–∞–ø–∫—É `auth/`:

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π:
```
routers/
  my_api_module/
    __init__.py
    router.py
    messages.py
    auth/                    # –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª—è
      __init__.py
      auth_manager.py        # –ú–µ–Ω–µ–¥–∂–µ—Ä –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
      script.py             # –°–∫—Ä–∏–ø—Ç –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤
      client_secret.json    # –ö–æ–Ω—Ñ–∏–≥–∏ API
      token.pkl            # –¢–æ–∫–µ–Ω—ã (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
```

### –ü—Ä–∏–º–µ—Ä auth_manager.py:
```python
"""
–ú–µ–Ω–µ–¥–∂–µ—Ä –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è –≤–∞—à–µ–≥–æ API
"""
import pickle
import logging
from pathlib import Path

logger = logging.getLogger(__name__)

class MyAPIAuthManager:
    def __init__(self, auth_dir: str | None = None):
        if auth_dir:
            self.auth_dir = Path(auth_dir)
        else:
            self.auth_dir = Path(__file__).parent
        
        self.token_file = self.auth_dir / "token.pkl"
        self.config_file = self.auth_dir / "client_secret.json"
        self.auth_dir.mkdir(exist_ok=True)
    
    def load_credentials(self):
        """–ó–∞–≥—Ä—É–∂–∞–µ—Ç —Ç–æ–∫–µ–Ω—ã –∏–∑ —Ñ–∞–π–ª–∞"""
        try:
            with open(self.token_file, "rb") as f:
                return pickle.load(f)
        except FileNotFoundError:
            logger.error(f"–¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω: {self.token_file}")
            return None
    
    def save_credentials(self, creds):
        """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–æ–∫–µ–Ω—ã –≤ —Ñ–∞–π–ª"""
        with open(self.token_file, "wb") as f:
            pickle.dump(creds, f)
        logger.info(f"–¢–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {self.token_file}")
    
    def is_authorized(self):
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é"""
        creds = self.load_credentials()
        return creds is not None
```

### –ü—Ä–∏–º–µ—Ä script.py –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:
```python
"""
–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è –≤–∞—à–µ–≥–æ API
"""
from pathlib import Path
import pickle

def main():
    auth_dir = Path(__file__).parent
    print(f"üîê –ù–∞—á–∏–Ω–∞–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é...")
    
    # –ó–¥–µ—Å—å –≤–∞—à–∞ –ª–æ–≥–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤
    # –ù–∞–ø—Ä–∏–º–µ—Ä, OAuth flow, API –∫–ª—é—á–∏ –∏ —Ç.–¥.
    
    token = "your_api_token_here"
    
    with open(auth_dir / "token.pkl", "wb") as f:
        pickle.dump(token, f)
    
    print(f"‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!")

if __name__ == "__main__":
    main()
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –º–æ–¥—É–ª–µ:
```python
# –í router.py
from .auth import MyAPIAuthManager

auth_manager = MyAPIAuthManager()

@my_module_router.callback_query(F.data == "my_mode")
async def activate_module(callback: CallbackQuery):
    if not auth_manager.is_authorized():
        await callback.message.edit_text(
            "‚ùå –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è!\n"
            f"–í—ã–ø–æ–ª–Ω–∏—Ç–µ: python {auth_manager.auth_dir}/script.py"
        )
        return
    
    # –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –º–æ–¥—É–ª—è
    await callback.message.edit_text("‚úÖ –ú–æ–¥—É–ª—å —Ä–∞–±–æ—Ç–∞–µ—Ç!")
```

---

## 8. üîß –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ö–Ω–æ–ø–∫–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ callback_data** –≤ `MENU_CONFIG` –∏ —Ö–µ–Ω–¥–ª–µ—Ä–µ:
   ```python
   # –í __init__.py
   'callback_data': 'my_mode'
   
   # –í router.py  
   @router.callback_query(F.data == "my_mode")  # –î–æ–ª–∂–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å!
   ```

2. **–£–±–µ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–µ aiogram 3.x:**
   ```python
   # ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
   @router.callback_query(F.data == "my_mode")
   
   # ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ (aiogram 2.x)
   @router.callback_query(text="my_mode")
   ```

### –ú–æ–¥—É–ª—å –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤ `__init__.py` –µ—Å—Ç—å —ç–∫—Å–ø–æ—Ä—Ç —Ä–æ—É—Ç–µ—Ä–∞:**
   ```python
   from .router import my_module_router  # –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–º—è —Ä–æ—É—Ç–µ—Ä–∞** - –¥–æ–ª–∂–Ω–æ –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è –Ω–∞ `_router`:
   ```python
   my_module_router = Router()  # ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
   my_module = Router()         # ‚ùå –ù–µ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è
   ```

### –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏
1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∏–ª—å—Ç—Ä—ã** –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞ —á—É–∂–∏—Ö callback:
   ```python
   # ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ - —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ callback
   @router.callback_query(F.data == "my_mode")
   
   # ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ - –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –í–°–ï callback
   @router.callback_query()
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å callback_data** –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏

### –ü—Ä–æ–±–ª–µ–º—ã —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π
1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º** –≤ auth_manager
2. **–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–µ—Ç —Ç–æ–∫–µ–Ω—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ø–∞–ø–∫–µ**
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞** –∫ –ø–∞–ø–∫–µ auth/

---

## 9. üîê –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–∞–º–∏ –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è —Å —Å–µ–∫—Ä–µ—Ç–∞–º–∏:
```
routers/
  my_api_module/
    __init__.py
    router.py
    config.py           # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –º–æ–¥—É–ª—è
    .env                # –°–µ–∫—Ä–µ—Ç—ã –º–æ–¥—É–ª—è (–Ω–µ –ø–æ–ø–∞–¥–µ—Ç –≤ git)
    .env.example        # –®–∞–±–ª–æ–Ω –¥–ª—è –¥—Ä—É–≥–∏—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
    messages.py
    auth/               # (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –¥–ª—è OAuth —Ç–æ–∫–µ–Ω–æ–≤
```

### üåç –ü—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫:

**–ì–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–∫–æ—Ä–Ω–µ–≤–æ–π `.env`):**
- `BOT_TOKEN` - —Ç–æ–∫–µ–Ω Telegram –±–æ—Ç–∞
- `ALLOWED_USER_IDS` - —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- –û–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –≤—Å–µ–º –±–æ—Ç–æ–º

**–ú–æ–¥—É–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–ª–æ–∫–∞–ª—å–Ω—ã–π `.env`):**
- API –∫–ª—é—á–∏ –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
- –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ URL –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –¢–æ–∫–µ–Ω—ã OAuth –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –º–æ–¥—É–ª—è

### üìù –ü—Ä–∏–º–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è –º–æ–¥—É–ª—è —Å —Å–µ–∫—Ä–µ—Ç–∞–º–∏:

#### 1. –°–æ–∑–¥–∞–π—Ç–µ `.env.example` (—à–∞–±–ª–æ–Ω):
```env
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤ .env –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è
MY_API_KEY=your_api_key_here
MY_SERVICE_URL=https://api.example.com
MY_WEBHOOK_SECRET=webhook_secret_here
```

#### 2. –°–æ–∑–¥–∞–π—Ç–µ `config.py` –º–æ–¥—É–ª—è:
```python
"""
–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è my_api_module
"""
import os
from pathlib import Path
from dotenv import load_dotenv

# –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ .env —Ñ–∞–π–ª–∞ –º–æ–¥—É–ª—è
module_dir = Path(__file__).parent
env_path = module_dir / '.env'

if env_path.exists():
    load_dotenv(env_path)
else:
    print(f"‚ö†Ô∏è  –§–∞–π–ª .env –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ {module_dir}")
    print(f"üìã –°–∫–æ–ø–∏—Ä—É–π—Ç–µ .env.example –≤ .env –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è")

# –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –º–æ–¥—É–ª—è
MY_API_KEY = os.getenv("MY_API_KEY")
MY_SERVICE_URL = os.getenv("MY_SERVICE_URL") 
MY_WEBHOOK_SECRET = os.getenv("MY_WEBHOOK_SECRET")

# –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
REQUIRED_VARS = {
    "MY_API_KEY": MY_API_KEY,
    "MY_SERVICE_URL": MY_SERVICE_URL,
}

missing_vars = [name for name, value in REQUIRED_VARS.items() if not value]
if missing_vars:
    raise ValueError(f"–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ: {', '.join(missing_vars)}")

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–¥—É–ª—è
MODULE_CONFIG = {
    'api_key': MY_API_KEY,
    'service_url': MY_SERVICE_URL,
    'webhook_secret': MY_WEBHOOK_SECRET,
    'timeout': 30,  # —Å–µ–∫—É–Ω–¥—ã
}
```

#### 3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤ `router.py`:
```python
from .config import MODULE_CONFIG, MY_API_KEY
import httpx

@my_module_router.callback_query(F.data == "my_mode")
async def activate_module(callback: CallbackQuery):
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ API –∫–ª—é—á –Ω–∞—Å—Ç—Ä–æ–µ–Ω
    if not MY_API_KEY:
        await callback.message.edit_text(
            "‚ùå –ú–æ–¥—É–ª—å –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω!\n"
            "–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª .env –≤ –ø–∞–ø–∫–µ –º–æ–¥—É–ª—è"
        )
        return
    
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º API
    async with httpx.AsyncClient() as client:
        response = await client.get(
            MODULE_CONFIG['service_url'],
            headers={'Authorization': f'Bearer {MY_API_KEY}'}
        )
```

### üîß –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:

–í README –º–æ–¥—É–ª—è –æ–±—ä—è—Å–Ω–∏—Ç–µ:
```markdown
## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤

1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `.env.example` –≤ `.env`:
   ```bash
   cp routers/my_module/.env.example routers/my_module/.env
   ```

2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `.env`:
   ```env
   MY_API_KEY=–≤–∞—à_–Ω–∞—Å—Ç–æ—è—â–∏–π_–∫–ª—é—á
   MY_SERVICE_URL=https://real-api.com
   ```

3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞ - –º–æ–¥—É–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∑–∏—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
```

### ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã:

1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –§–∞–π–ª—ã `.env` –≤ –º–æ–¥—É–ª—è—Ö –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–∫–ª—é—á–µ–Ω—ã –∏–∑ git
2. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –í—Å–µ–≥–¥–∞ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ `.env.example` –¥–ª—è –¥—Ä—É–≥–∏—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
3. **–í–∞–ª–∏–¥–∞—Ü–∏—è**: –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –º–æ–¥—É–ª—è
4. **–ò–∑–æ–ª—è—Ü–∏—è**: –ú–æ–¥—É–ª–∏ –Ω–µ –≤–∏–¥—è—Ç —Å–µ–∫—Ä–µ—Ç—ã –¥—Ä—É–≥ –¥—Ä—É–≥–∞
5. **Fallback**: –ü—Ä–µ–¥—É—Å–º–æ—Ç—Ä–∏—Ç–µ –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
6. **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å**: –ù–ï —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è —Å–≤–æ–µ–≥–æ –º–æ–¥—É–ª—è (keyboards/my_module.py, services/my_module.py)
7. **–õ–æ–∫–∞–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã**: –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã, —Å–µ—Ä–≤–∏—Å—ã, –∫–æ–Ω—Ñ–∏–≥–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–Ω—É—Ç—Ä–∏ –º–æ–¥—É–ª—è

---

## 10. üìã –ß–µ–∫-–ª–∏—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –º–æ–¥—É–ª—è

### –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:
- [ ] –°–æ–∑–¥–∞–Ω–∞ –ø–∞–ø–∫–∞ `routers/my_module/`
- [ ] –°–æ–∑–¥–∞–Ω `__init__.py` —Å —ç–∫—Å–ø–æ—Ä—Ç–æ–º —Ä–æ—É—Ç–µ—Ä–∞ –∏ `MENU_CONFIG`
- [ ] –°–æ–∑–¥–∞–Ω `router.py` —Å –æ–±—ä–µ–∫—Ç–æ–º Router
- [ ] –°–æ–∑–¥–∞–Ω `messages.py` —Å —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å aiogram 3.x (`F.data == "callback"`)
- [ ] Callback_data —É–Ω–∏–∫–∞–ª–µ–Ω –∏ —Å–æ–≤–ø–∞–¥–∞–µ—Ç –≤ `MENU_CONFIG` –∏ —Ö–µ–Ω–¥–ª–µ—Ä–µ
- [ ] –î–æ–±–∞–≤–ª–µ–Ω—ã —Ñ–∏–ª—å—Ç—Ä—ã –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤

### –°–µ–∫—Ä–µ—Ç—ã –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–µ—Å–ª–∏ –Ω—É–∂–Ω—ã):
- [ ] –°–æ–∑–¥–∞–Ω `.env.example` —Å —à–∞–±–ª–æ–Ω–æ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- [ ] –°–æ–∑–¥–∞–Ω `config.py` —Å –∑–∞–≥—Ä—É–∑–∫–æ–π –º–æ–¥—É–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- [ ] –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –∏–∑–æ–ª—è—Ü–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤ –º–æ–¥—É–ª—è

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–∞):
- [ ] (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –°–æ–∑–¥–∞–Ω–∞ –ø–∞–ø–∫–∞ `auth/` –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö API
- [ ] –°–æ–∑–¥–∞–Ω `auth_manager.py` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞–º–∏
- [ ] –°–æ–∑–¥–∞–Ω `script.py` –¥–ª—è –ø–µ—Ä–≤–∏—á–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞ —Ä–∞–±–æ—Ç–∞ –∫–Ω–æ–ø–∫–∏ –∏ —Ö–µ–Ω–¥–ª–µ—Ä–æ–≤
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –º–æ–¥—É–ª—å –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç —Å –¥—Ä—É–≥–∏–º–∏

---

## 11. üí° –ü—Ä–∏–º–µ—Ä—ã –≥–æ—Ç–æ–≤—ã—Ö –º–æ–¥—É–ª–µ–π

### –°–∏—Å—Ç–µ–º–Ω—ã–π –º–æ–¥—É–ª—å: `core` 
- **–ù–ï –¢–†–û–ì–ê–ô–¢–ï –ï–ì–û!** - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã `/start`, `/menu`
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π
- –í—Å–µ–≥–¥–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–µ—Ä–≤—ã–º –≤ —Å–ø–∏—Å–∫–µ (order: 1)
- –ü—Ä–∏–º–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –∫–æ–º–∞–Ω–¥

### –ü—Ä–æ—Å—Ç–æ–π –º–æ–¥—É–ª—å: `id_module`
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —á–∞—Ç–∞
- –û–¥–∏–Ω callback —Ö–µ–Ω–¥–ª–µ—Ä
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

### –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π: `test_module` 
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–∞–∑–Ω—ã–µ —Ç–∏–ø—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤
- Callback, —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –∏ —ç–º–æ–¥–∑–∏ —Ö–µ–Ω–¥–ª–µ—Ä—ã
- `callback.answer()` –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏

### –°–ª–æ–∂–Ω—ã–π –º–æ–¥—É–ª—å: `email_router`
- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Google OAuth
- –†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏ –∏ –≤–ª–æ–∂–µ–Ω–∏—è–º–∏
- –°–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è –ø–∞–ø–∫–∞ `auth/` —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- –ü—Ä–∏–º–µ—Ä –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–≥–æ –º–æ–¥—É–ª—è —Å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞–º–∏ –∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏

–ò–∑—É—á–∏—Ç–µ —ç—Ç–∏ –º–æ–¥—É–ª–∏ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –ª—É—á—à–∏—Ö –ø—Ä–∞–∫—Ç–∏–∫! üìö 